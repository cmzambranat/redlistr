---
title: "Introduction to the 'redlistr' package"
author: "Calvin K.F. Lee, Nicholas J. Murray"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction to the 'redlistr' package}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
## 1. Introduction
This document provides an introduction to conducting assessments for the IUCN 
Red List of Ecosystems in `R`. Assessments of ecosystems under the IUCN Red List
of Ecosystems criteria require calculation of standardised metrics that were 
developed to objectively assess risk to ecosystem ([Keith et al. 2013](http://journals.plos.org/plosone/article?id=10.1371/journal.pone.0062111)).
The `redlistr` package was developed to assist in the calculation of these
metrics, which include establishing the two standard measures of the size of an 
ecosystems' geographic distribution , as measured by the Area of Occupancy (AOO)
and Extent of Occurrence (EOO). As many of these measures are also useful for 
assessing species under the IUCN Red List of Threatened Species criteria, we 
expect this package will also be useful for assessors conducting species 
assessments.

In conducting an assessment with this package, we assume that you are familiar 
with IUCN red listing protocols. In particular, you should consult the IUCN 
guidelines for both of the red lists, which are the definitive sources of all 
information required to ensure consistent application of IUCN criteria (IUCN, 
[2015](link here); [Bland et al. 2016](https://portals.iucn.org/library/sites/library/files/documents/2016-010.pdf)).
In addition, the papers by Keith et al.
([2013](http://journals.plos.org/plosone/article?id=10.1371/journal.pone.0062111))
and Rodriguez et al. ([2015](https://www.iucn.org/sites/dev/files/content/documents/rodriguez-etal-2015-a-practical-guide-iucn-rle_erratum.pdf)) are particularly useful for navigating the IUCN Red
List of Ecosystems criteria. A range of important resources, including software
tools and guiding material is available on the IUCN Red List of Ecosystems
[website](www.iucnrle.org). There is also plenty of handy material for assessing
species available on the IUCN Red List of Threatened Species
[website](http://www.iucnredlist.org).

We also assume that you are reasonably familiar with the `R` programming
language, and have some experience in conducting analyses of vector and raster
data within the `R` environment. Of particular use will be familiarity with the
`Raster`, `sp` and `rgeos` packages. This is certainly not a prerequisite, but
this package is built upon many of the functions available in these three
packages.

Last, this is a work in progress and we aim to continually add new functions to 
newer versions of package. Suggestions are welcomed, as would offers for 
collaborative development.

## 2. Importing data
In this vignette, we will be focusing mainly on the `redlistr` tools aimed at
assessing the spatial criteria of the IUCN Red List of Ecosystems. These
criteria assess the change in the extent of an ecosystem over time (Criterion A)
and properties of the geographic distribution size (Criterion B). Both of these
criteria require the use of maps of ecosystem distributions.

Most distribution maps of ecosystems and species will be provided in raster or
vector (shapefile) format. We will be using the `sp`, `raster`, and `rgeos`
packages which `redlistr` is built on top of.

```{r Loading packages, message=FALSE}
# install.packages(c("raster", "sp", "rgeos"))
library(raster)
library(sp)
library(rgeos)
library(devtools) # required for the GitHub version of redlistr
load_all("C:/Users/kfle/Desktop/GitHub/redlistr")
```

We will first have to import the data we want to analyse. In this vignette, we
will be using two mangrove distributions frm the northern regions of Western
Port Bay, Victoria, Australia. The first distribution is from Giri et al.
([2011](http://onlinelibrary.wiley.com/doi/10.1111/j.1466-8238.2010.00584.x/abstract)),
and represents mangrove distribution in 2000. The second distribution is a
classification map generated using the `XGBoost` package and data from Landsat 
8, and represents mangrove distribution in 2017. Both of these distributions are
stored as rasters, and a raster value of 1 denotes presence.

To import your own data, you can use the `raster` function in the `raster`
package, which can handle many different types of georeferenced spatial data.
More information on the `raster` package can be found
[here](https://cran.r-project.org/web/packages/raster/raster.pdf).

```{r Loading our example distributions}
mangrove.2000 <- raster(system.file("extdata", "example_distribution_2000.tif", package = "redlistr"))
mangrove.2017 <- raster(system.file("extdata", "example_distribution_2017.tif", package = "redlistr"))

```

We can plot the data to view the two distributions to get a general idea of how
the distribution might have changed over time.

```{r Plotting the two rasters, fig.show='hold'}
plot (mangrove.2000, col = "grey30", legend = FALSE, main = "Mangrove Distribution")
plot (mangrove.2017, add = T, col = "darkorange", legend = FALSE)
```

We can see that there has been some decrease in mangrove cover, though the loss
does not seem to be too extensive.

At this stage it is also important to check that data are at least in the right
location. This can be acheived by simply plotting the map and checking the
coordinates, or check the distribution maps against satellite images. This can
be acheived using packages such as `ggmap`, `plotgooglemaps`, `googleVis` etc.
It is also important to check that the data are suitable for the task at hand.

## 3. Basic information for the data
We can now use some of features of `redlistr` to get some basic information on
the ecosystem. However, before proceeing it is wise to check that the data have
the same grain size (resolution), and spatial properties (spatial extent, origin
and projection). This can be acheived using features from the `raster` package,
such as `aggregate`, `resample` and `projectRaster`.

Below we check the projections of the data to ensure they are consistent:

```{r Checking CRS and resolutions}
crs(mangrove.2000)
crs(mangrove.2017)
```

It should be noted here that for `redlistr` to function properly, the projection
used should be measured in metres.

Now we can begin to use the functions included in `redlistr`, which we have
already loaded at the beginning of the vignette.

We start by calculating the area of the dataset, noting there has been a decline
in area of the ecosystem over time. Area is calculated here using the pixel
count method, where the number of pixels classified as the ecosystem of interest
is multiplied by the area of each pixel is used to determine the area of the
whole ecosystem. The area calculated is provided in square kilometres. 

```{r Calculate area of rasters}
a.2000 <- getArea(mangrove.2000)
a.2000
a.2017 <- getArea(mangrove.2017)
a.2017
```

The results: at time 1 (2000), the ecosystem was `r a.2000` km^2^, and at time
2, (2017) the ecosystem was `r a.2017` km^2^.

## 4. Assessing Criterion A

The IUCN Red List of Ecosystems criterion A requires estimates of the magnitude of
change over time. This is typically calculated over a 50 year time period (past,
present or future) or against a historical baseline ([Bland et al 2016](https://portals.iucn.org/library/sites/library/files/documents/2016-010.pdf)).
The first step towards acheiving this change estimate over a fixed time frame is
to assess the amount of change observed in your data.

### Area change

Area change can be calculated using the `getAreaLoss` function. It simply
calculates the difference in area between two datasets. It can accept data from
numbers, `RasterLayers` or `SpatialPolygons`. Make sure to use area measure in
km^2^ if you are using numbers as the input.

```{r Using getAreaChange}
area.lost <- getAreaLoss(a.2000, a.2017)
# getAreaLoss(mangrove.2000, mangrove.2017) generates identical results

```

### Rate of change

In the Red List of Ecosystems, two methods are suggested to determine the rate
of decline of an ecosystem, each of which assumes a different functional form of
the decline (IUCN, 2015).  The proportional rate of decline (PRD) is a fraction
of the previous year's remaining area, while the absolute rate of decline (ARD)
is a constant fraction of the area of the ecosystem at the beginning of the
decline (IUCN, 2015). These rates of decline allow the use of two or more data 
points to extrapolate to the full 50 year timeframe required in an assessment.

The annual rate of change (ARC) uses a compound interest law to determine the 
instantaneous rate of change ([Puyravaud 2003](http://www.sciencedirect.com/science/article/pii/S0378112702003353)). 

To estimate the rate of changing using these methods, we use the
`getDeclineStats` function. 

```{r Using getDeclineStats}
decline.stats <- getDeclineStats(a.2000, a.2017, 2000, 2017)
decline.stats
```

Each method represent a different shape of decline. For further information about
the choice of each of these methods to extrapolate refer to the IUCN Red List of
Ecosystems guidelines ([Bland et al 2016](https://portals.iucn.org/library/sites/library/files/documents/2016-010.pdf)).

Now it is possible to extrapolate, using only two estimates of an ecosystems' area, to the full 50 year period required for a Red List of Ecosystems assessment. 

```{r}
extrapolated.area <- futureAreaEstimate(a.2000, year.t1 = 2000, 
                                        PRD = decline.stats$PRD, 
                                        ARD = decline.stats$ARD, 
                                        ARC = decline.stats$ARC, 
                                        nYears = 50)
extrapolated.area
```

This tells us that 50 years from our first estimate in year `r extrapolated.area$forecast.year` km2 , all things aside, we expect this ecosystem to have declined by `r extrapolated.area$prd`%. It is important to note that this relatively simple exercise is founded on assumptions that should be fully understood before submitting your ecosystem assessment to the IUCN Red List of Ecosystems Committee for Scientific Standards. Please see the guidelines (Bland et al 2016) for more information.

## 4. Assessing Criterion B (distribution size)


Criterion B utilizes measures of the geographic distribution of an ecosystem type to identify ecosystems that are at risk from catastrophic disturbances. The geographic distribution of an ecosystem type is assessed under criterion B with two standardized metrics: the extent of occurrence (EOO) and the area of occupancy (AOO) (Gaston and Fuller, 2009, Keith et al., 2013). It must be emphasised that EOO and AOO are not used to estimate the mapped area of an ecosystem like the methods we used in Criterion A; they are simply spatial metrics that allow us to standardise an estimate of risk spreading. Thus, it is critical that these measures are used consistently across all assessments, and the use of non-standard measures invalidates comparison against the thresholds. Refer to the guidelines for more information on AOO and EOO.
